<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.web.WebView?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.example.forevernote.ui.controller.MainController"
            styleClass="root-container">
    
    <!-- Top Menu Bar -->
    <top>
        <VBox styleClass="top-container">
            <MenuBar fx:id="menuBar" styleClass="menu-bar">
                <Menu text="%menu.file">
                    <MenuItem text="%action.new_note" onAction="#handleNewNote" accelerator="Shortcut+N"/>
                    <MenuItem text="%action.new_folder" onAction="#handleNewFolder" accelerator="Shortcut+Shift+N"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.save" onAction="#handleSave" accelerator="Shortcut+S"/>
                    <MenuItem text="%action.save_all" onAction="#handleSaveAll" accelerator="Shortcut+Shift+S"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.import" onAction="#handleImport" accelerator="Shortcut+I"/>
                    <MenuItem text="%action.export" onAction="#handleExport" accelerator="Shortcut+E"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.exit" onAction="#handleExit" accelerator="Shortcut+Q"/>
                </Menu>
                
                <Menu text="%menu.edit">
                    <MenuItem text="%action.undo" onAction="#handleUndo" accelerator="Shortcut+Z"/>
                    <MenuItem text="%action.redo" onAction="#handleRedo" accelerator="Shortcut+Y"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.cut" onAction="#handleCut" accelerator="Shortcut+X"/>
                    <MenuItem text="%action.copy" onAction="#handleCopy" accelerator="Shortcut+C"/>
                    <MenuItem text="%action.paste" onAction="#handlePaste" accelerator="Shortcut+V"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.find" onAction="#handleFind" accelerator="Shortcut+F"/>
                    <MenuItem text="%action.replace" onAction="#handleReplace" accelerator="Shortcut+H"/>
                </Menu>
                
                <Menu text="%menu.view">
                    <MenuItem text="%action.toggle_sidebar" onAction="#handleToggleSidebar" accelerator="F9"/>
                    <MenuItem text="%action.toggle_notes_list" onAction="#handleToggleNotesPanel" accelerator="F8"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.zoom_in" onAction="#handleZoomIn" accelerator="Shortcut+Plus"/>
                    <MenuItem text="%action.zoom_out" onAction="#handleZoomOut" accelerator="Shortcut+Minus"/>
                    <MenuItem text="%action.reset_zoom" onAction="#handleResetZoom" accelerator="Shortcut+0"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.zoom_editor_in" onAction="#handleEditorZoomIn" accelerator="Shortcut+Shift+Plus"/>
                    <MenuItem text="%action.zoom_editor_out" onAction="#handleEditorZoomOut" accelerator="Shortcut+Shift+Minus"/>
                    <MenuItem text="%action.reset_editor_zoom" onAction="#handleEditorResetZoom" accelerator="Shortcut+Shift+0"/>
                    <SeparatorMenuItem/>
                    <Menu text="%menu.language">
                        <RadioMenuItem fx:id="englishLangMenuItem" text="%lang.en" onAction="#handleLanguageEnglish"/>
                        <RadioMenuItem fx:id="spanishLangMenuItem" text="%lang.es" onAction="#handleLanguageSpanish"/>
                    </Menu>
                    <SeparatorMenuItem/>
                    <Menu text="%menu.theme">
                        <RadioMenuItem fx:id="lightThemeMenuItem" text="%theme.light" selected="true" onAction="#handleLightTheme"/>
                        <RadioMenuItem fx:id="darkThemeMenuItem" text="%theme.dark" onAction="#handleDarkTheme"/>
                        <RadioMenuItem fx:id="systemThemeMenuItem" text="%theme.system" onAction="#handleSystemTheme"/>
                    </Menu>
                </Menu>
                
                <Menu text="%menu.tools">
                    <MenuItem text="%action.command_palette" onAction="#handleCommandPalette" accelerator="Shortcut+P"/>
                    <MenuItem text="%action.quick_switcher" onAction="#handleQuickSwitcher" accelerator="Shortcut+O"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%action.global_search" onAction="#handleSearch" accelerator="Shortcut+Shift+F"/>
                    <MenuItem text="%action.tags_manager" onAction="#handleTagsManager"/>
                    <SeparatorMenuItem/>
                    <Menu fx:id="pluginsMenu" text="%menu.plugins">
                        <MenuItem text="%action.manage_plugins" onAction="#handlePluginManager"/>
                        <SeparatorMenuItem/>
                        <!-- Plugin menu items are added dynamically by plugins -->
                    </Menu>
                    <SeparatorMenuItem/>
                    <MenuItem text="%menu.preferences" onAction="#handlePreferences"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%pref.storage" onAction="#handleSwitchStorage"/>
                </Menu>
                
                <Menu text="%menu.help">
                    <MenuItem text="%menu.documentation" onAction="#handleDocumentation"/>
                    <MenuItem text="%menu.shortcuts" onAction="#handleKeyboardShortcuts" accelerator="F1"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="%menu.about" onAction="#handleAbout"/>
                </Menu>
            </MenuBar>
            
            <!-- Toolbar -->
            <HBox fx:id="toolbarHBox" styleClass="toolbar" spacing="8" alignment="CENTER_LEFT">
                <padding>
                    <Insets top="8" right="16" bottom="8" left="16"/>
                </padding>
                
                <!-- Layout Toggles -->
                <ToggleButton fx:id="sidebarToggleBtn" onAction="#handleToggleSidebar" styleClass="modern-toggle-btn">
                   <tooltip><Tooltip text="%action.toggle_sidebar"/></tooltip>
                   <graphic>
                       <FontIcon iconLiteral="fth-sidebar" styleClass="feather-icon"/>
                   </graphic>
                </ToggleButton>
                <ToggleButton fx:id="notesPanelToggleBtn" onAction="#handleToggleNotesPanel" styleClass="modern-toggle-btn">
                   <tooltip><Tooltip text="%action.toggle_notes_list"/></tooltip>
                    <graphic>
                       <FontIcon iconLiteral="fth-list" styleClass="feather-icon"/>
                   </graphic>
                </ToggleButton>
                <Button fx:id="layoutSwitchBtn" onAction="#handleViewLayoutSwitch" styleClass="toolbar-btn">
                   <tooltip><Tooltip text="%action.switch_layout"/></tooltip>
                    <graphic>
                       <FontIcon iconLiteral="fth-columns" styleClass="feather-icon"/>
                   </graphic>
                </Button>
                
                <Separator fx:id="toolbarSeparator1" orientation="VERTICAL" styleClass="toolbar-separator"/>

                <!-- File Actions -->
                <Button fx:id="newNoteBtn" onAction="#handleNewNote" styleClass="toolbar-btn toolbar-btn-primary">
                    <tooltip><Tooltip text="%action.new_note"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-file-plus" styleClass="feather-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="newFolderBtn" onAction="#handleNewFolder" styleClass="toolbar-btn">
                    <tooltip><Tooltip text="%action.new_folder"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-folder-plus" styleClass="feather-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="newTagBtn" onAction="#handleNewTag" styleClass="toolbar-btn">
                    <tooltip><Tooltip text="%action.new_tag"/></tooltip>
                    <graphic>
                       <FontIcon iconLiteral="fth-hash" styleClass="feather-icon"/>
                   </graphic>
                </Button>
                
                <Separator fx:id="toolbarSeparator2" orientation="VERTICAL" styleClass="toolbar-separator"/>
                
                <Button fx:id="saveBtn" onAction="#handleSave" styleClass="toolbar-btn">
                    <tooltip><Tooltip text="%action.save"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-save" styleClass="feather-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="deleteBtn" onAction="#handleDelete" styleClass="toolbar-btn toolbar-btn-danger">
                    <tooltip><Tooltip text="%action.delete"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-trash-2" styleClass="feather-icon-danger"/>
                    </graphic>
                </Button>
                <Separator fx:id="toolbarSeparator3" orientation="VERTICAL" styleClass="toolbar-separator"/>
                
                <!-- Search Box -->
                <TextField fx:id="searchField" promptText="%app.search.placeholder" prefWidth="240" styleClass="search-field"/>
                
                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- View toggle buttons (List/Grid) -->
                <ToggleButton fx:id="listViewButton" onAction="#handleListView" styleClass="modern-toggle-btn" selected="true">
                    <tooltip><Tooltip text="%action.list_view"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-align-justify" styleClass="feather-icon"/>
                    </graphic>
                </ToggleButton>
                <ToggleButton fx:id="gridViewButton" onAction="#handleGridView" styleClass="modern-toggle-btn">
                    <tooltip><Tooltip text="%action.grid_view"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-grid" styleClass="feather-icon"/>
                    </graphic>
                </ToggleButton>

                <!-- Overflow Menu Button -->
                <MenuButton fx:id="toolbarOverflowBtn" styleClass="modern-toggle-btn" visible="false" managed="false">
                    <tooltip><Tooltip text="%action.more_actions"/></tooltip>
                    <graphic>
                        <FontIcon iconLiteral="fth-more-horizontal" styleClass="feather-icon"/>
                    </graphic>
                </MenuButton>
            </HBox>
        </VBox>
    </top>
    
    <!-- Main Content Area -->
    <center>
        <SplitPane fx:id="mainSplitPane" dividerPositions="0.22" styleClass="main-split">
            <!-- Left Sidebar -->
            <VBox fx:id="sidebarPane" styleClass="sidebar" minWidth="200">
                <!-- Navigation Tabs -->
                <TabPane fx:id="navigationTabPane" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS" styleClass="sidebar-tabs">
                    <Tab text="%tab.folders" closable="false">
                        <VBox spacing="0">
                            <HBox spacing="4" alignment="CENTER_LEFT" styleClass="sidebar-toolbar">
                                <padding><Insets top="4" right="4" bottom="4" left="4"/></padding>
                                <TextField fx:id="filterFoldersField" promptText="%app.search.placeholder" styleClass="search-field, small-search" HBox.hgrow="ALWAYS"/>
                                <Button onAction="#handleSortFolders" styleClass="icon-btn">
                                     <tooltip><Tooltip text="Toggle Sort (A-Z / Z-A)"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-filter" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                                <Button onAction="#handleExpandAllFolders" styleClass="icon-btn">
                                      <tooltip><Tooltip text="%action.expand_all"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-maximize-2" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                                <Button onAction="#handleCollapseAllFolders" styleClass="icon-btn">
                                      <tooltip><Tooltip text="%action.collapse_all"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-minimize-2" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                            </HBox>
                            <TreeView fx:id="folderTreeView" showRoot="true" styleClass="sidebar-tree" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                    
                    <Tab text="%tab.tags" closable="false">
                        <VBox spacing="0">
                             <HBox spacing="4" alignment="CENTER_LEFT" styleClass="sidebar-toolbar">
                                <padding><Insets top="4" right="4" bottom="4" left="4"/></padding>
                                <TextField fx:id="filterTagsField" promptText="%tab.tags.filter" styleClass="search-field, small-search" HBox.hgrow="ALWAYS"/>
                                <Button onAction="#handleSortTags" styleClass="icon-btn">
                                     <tooltip><Tooltip text="%action.sort_tags"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-filter" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                            </HBox>
                            <ListView fx:id="tagListView" styleClass="sidebar-list" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                    
                    <Tab text="%tab.recent" closable="false">
                        <VBox spacing="0">
                             <HBox spacing="4" alignment="CENTER_LEFT" styleClass="sidebar-toolbar">
                                <padding><Insets top="4" right="4" bottom="4" left="4"/></padding>
                                <TextField fx:id="filterRecentField" promptText="%tab.recent.filter" styleClass="search-field, small-search" HBox.hgrow="ALWAYS"/>
                                <Button onAction="#handleSortRecent" styleClass="icon-btn">
                                     <tooltip><Tooltip text="%action.sort_recent"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-filter" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                            </HBox>
                            <ListView fx:id="recentNotesListView" styleClass="sidebar-list" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                    
                    <Tab text="%tab.favorites" closable="false">
                        <VBox spacing="0">
                             <HBox spacing="4" alignment="CENTER_LEFT" styleClass="sidebar-toolbar">
                                <padding><Insets top="4" right="4" bottom="4" left="4"/></padding>
                                <TextField fx:id="filterFavoritesField" promptText="%tab.favorites.filter" styleClass="search-field, small-search" HBox.hgrow="ALWAYS"/>
                                <Button onAction="#handleSortFavorites" styleClass="icon-btn">
                                     <tooltip><Tooltip text="%action.sort_favorites"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-filter" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                            </HBox>
                            <ListView fx:id="favoritesListView" styleClass="sidebar-list" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                    
                    <Tab text="%tab.trash" closable="false">
                        <VBox spacing="0">
                             <HBox spacing="4" alignment="CENTER_LEFT" styleClass="sidebar-toolbar">
                                <padding><Insets top="4" right="4" bottom="4" left="4"/></padding>
                                <TextField fx:id="filterTrashField" promptText="%tab.trash.filter" styleClass="search-field, small-search" HBox.hgrow="ALWAYS"/>
                                <Button onAction="#handleSortTrash" styleClass="icon-btn">
                                     <tooltip><Tooltip text="%action.sort_trash"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-filter" iconSize="14" styleClass="feather-icon"/></graphic>
                                </Button>
                                <Button onAction="#handleEmptyTrash" styleClass="icon-btn">
                                     <tooltip><Tooltip text="%action.empty_trash"/></tooltip>
                                     <graphic><FontIcon iconLiteral="fth-trash-2" iconSize="14" styleClass="feather-icon-danger"/></graphic>
                                </Button>
                            </HBox>
                            <TreeView fx:id="trashTreeView" styleClass="sidebar-list" VBox.vgrow="ALWAYS" showRoot="false"/>
                        </VBox>
                    </Tab>
                </TabPane>
                
                <!-- Use Spacer instead of buttons -->
                <Region VBox.vgrow="NEVER" minHeight="10"/>
            </VBox>
            
            <!-- Right Content Area -->
            <SplitPane fx:id="contentSplitPane" dividerPositions="0.25" styleClass="content-split">
                <!-- Notes List Panel -->
                <VBox fx:id="notesPanel" styleClass="notes-panel" minWidth="0" prefWidth="280">
                   <!-- Stacked mode close button (hidden by default) -->
                   <HBox fx:id="stackedModeHeader" managed="false" visible="false" alignment="CENTER_RIGHT" styleClass="stacked-header">
                       <Button onAction="#handleToggleNotesPanel" styleClass="icon-btn-small">
                           <graphic>
                               <FontIcon iconLiteral="fth-x" iconSize="14"/>
                           </graphic>
                       </Button>
                   </HBox>

                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="notes-header">
                        <padding>
                            <Insets top="12" right="12" bottom="12" left="12"/>
                        </padding>
                        <Label fx:id="notesPanelTitleLabel" text="%panel.notes.title" styleClass="panel-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="sortComboBox" prefWidth="120" styleClass="sort-combo"/>
                        <Button fx:id="refreshBtn" onAction="#handleRefresh" styleClass="icon-btn">
                            <tooltip><Tooltip text="%tooltip.refresh_list"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fth-refresh-cw" styleClass="feather-icon"/>
                            </graphic>
                        </Button>
                    </HBox>
                    
                    <ListView fx:id="notesListView" VBox.vgrow="ALWAYS" styleClass="notes-list"/>
                </VBox>
                
                <!-- Editor + Preview Panel -->
                <VBox fx:id="editorContainer" styleClass="editor-container" HBox.hgrow="ALWAYS">
                    <!-- Editor Header -->
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="editor-header">
                        <padding>
                            <Insets top="10" right="16" bottom="10" left="16"/>
                        </padding>
                        <TextField fx:id="noteTitleField" promptText="%panel.editor.title_placeholder" HBox.hgrow="ALWAYS" styleClass="title-field"/>
                        <Separator orientation="VERTICAL" styleClass="header-separator"/>
                         
                        <!-- Tags Toggle UI -->
                         <ToggleButton fx:id="toggleTagsBtn" onAction="#handleToggleTags" styleClass="modern-toggle-btn" selected="true">
                            <tooltip><Tooltip text="%tooltip.toggle_tags"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fth-hash" styleClass="feather-icon"/>
                            </graphic>
                        </ToggleButton>
                        
                        <Separator orientation="VERTICAL" styleClass="header-separator"/>
                        
                        <!-- View Mode Toggle -->
                        <ToggleButton fx:id="editorOnlyButton" text="%action.editor_only" onAction="#handleEditorOnlyMode" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.editor_only"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="splitViewButton" text="%action.split_view" onAction="#handleSplitViewMode" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.split_view"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="previewOnlyButton" text="%action.preview_only" onAction="#handlePreviewOnlyMode" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.preview_only"/></tooltip>
                        </ToggleButton>
                        <Separator orientation="VERTICAL" styleClass="header-separator"/>
                        <ToggleButton fx:id="pinButton" onAction="#handleTogglePin" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.pin_note"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fth-map-pin" styleClass="feather-icon"/>
                            </graphic>
                        </ToggleButton>
                        <ToggleButton fx:id="favoriteButton" onAction="#handleToggleFavorite" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.add_favorite"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fth-star" styleClass="feather-icon"/>
                            </graphic>
                        </ToggleButton>
                        <ToggleButton fx:id="infoButton" onAction="#handleToggleRightPanel" styleClass="modern-toggle-btn">
                            <tooltip><Tooltip text="%tooltip.toggle_right_panel"/></tooltip>
                            <graphic>
                                <FontIcon iconLiteral="fth-menu" styleClass="feather-icon"/>
                            </graphic>
                        </ToggleButton>
                    </HBox>
                    
                    <!-- Tags Bar (Collapsible) -->
                    <VBox fx:id="tagsContainer">
                        <HBox alignment="CENTER_LEFT" spacing="8" styleClass="tags-bar">
                            <padding>
                                <Insets top="6" right="16" bottom="6" left="16"/>
                            </padding>
                            <FlowPane fx:id="tagsFlowPane" hgap="6" vgap="6" styleClass="tags-flow" HBox.hgrow="ALWAYS"/>
                            <Label fx:id="modifiedDateLabel" text="" styleClass="meta-label"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Editor/Preview Split -->
                    <SplitPane fx:id="editorPreviewSplitPane" orientation="HORIZONTAL" dividerPositions="0.5" VBox.vgrow="ALWAYS" styleClass="editor-split">
                        <!-- Editor Pane -->
                        <VBox fx:id="editorPane" styleClass="editor-pane">
                            <TextArea fx:id="noteContentArea" promptText="Start writing in Markdown..." wrapText="true" VBox.vgrow="ALWAYS" styleClass="editor-area"/>
                            
                            <!-- Editor Toolbar (Modern-style) - Scrollable for responsiveness -->
                            <HBox styleClass="format-toolbar-container">
                                <ScrollPane hbarPolicy="AS_NEEDED" vbarPolicy="NEVER" fitToHeight="true" styleClass="format-toolbar-scroll" HBox.hgrow="ALWAYS">
                                    <HBox alignment="CENTER_LEFT" spacing="4" styleClass="format-toolbar">
                                        <padding>
                                            <Insets top="6" right="8" bottom="6" left="8"/>
                                        </padding>
                                        <Button fx:id="heading1Btn" text="H1" onAction="#handleHeading1" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 1"/></tooltip>
                                        </Button>
                                        <Button fx:id="heading2Btn" text="H2" onAction="#handleHeading2" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 2"/></tooltip>
                                        </Button>
                                        <Button fx:id="heading3Btn" text="H3" onAction="#handleHeading3" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 3"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="boldBtn" text="B" onAction="#handleBold" styleClass="format-btn format-bold">
                                            <tooltip><Tooltip text="Bold (Ctrl+B)"/></tooltip>
                                        </Button>
                                        <Button fx:id="italicBtn" text="I" onAction="#handleItalic" styleClass="format-btn format-italic">
                                             <tooltip><Tooltip text="Italic (Ctrl+I)"/></tooltip>
                                        </Button>
                                        <Button fx:id="strikeBtn" text="S" onAction="#handleUnderline" styleClass="format-btn format-strike">
                                            <tooltip><Tooltip text="Strikethrough"/></tooltip>
                                        </Button>
                                        <Button fx:id="underlineBtn" text="U" onAction="#handleRealUnderline" styleClass="format-btn format-underline">
                                            <tooltip><Tooltip text="Underline"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="highlightBtn" text="Hi" onAction="#handleHighlight" styleClass="format-btn">
                                            <tooltip><Tooltip text="Highlight"/></tooltip>
                                        </Button>
                                        <Button fx:id="linkBtn" text="Lk" onAction="#handleLink" styleClass="format-btn">
                                            <tooltip><Tooltip text="Insert link (Ctrl+K)"/></tooltip>
                                        </Button>
                                        <Button fx:id="imageBtn" text="Img" onAction="#handleImage" styleClass="format-btn">
                                            <tooltip><Tooltip text="Insert image"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="todoBtn" text="[ ]" onAction="#handleTodoList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Checkbox"/></tooltip>
                                        </Button>
                                        <Button fx:id="bulletBtn" text="-" onAction="#handleBulletList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Bullet list"/></tooltip>
                                        </Button>
                                        <Button fx:id="numberBtn" text="1." onAction="#handleNumberedList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Numbered list"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="quoteBtn" text="&gt;" onAction="#handleQuote" styleClass="format-btn">
                                            <tooltip><Tooltip text="Blockquote"/></tooltip>
                                        </Button>
                                        <Button fx:id="codeBtn" text="&lt;/&gt;" onAction="#handleCode" styleClass="format-btn">
                                            <tooltip><Tooltip text="Code block"/></tooltip>
                                        </Button>
                                    </HBox>
                                </ScrollPane>
                                <Label fx:id="wordCountLabel" text="0 words" styleClass="word-count"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Preview Pane -->
                        <VBox fx:id="previewPane" styleClass="preview-pane">
                            <HBox styleClass="preview-header">
                                <padding>
                                    <Insets top="8" right="12" bottom="8" left="12"/>
                                </padding>
                                <Label text="Preview" styleClass="preview-label"/>
                            </HBox>
                            <WebView fx:id="previewWebView" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </SplitPane>
                </VBox>
            </SplitPane>
        </SplitPane>
    </center>
    
    <!-- Right Panel (multiple collapsible sections) -->
    <right>
        <VBox fx:id="rightPanel" visible="false" managed="false" styleClass="right-panel" minWidth="260" prefWidth="300" maxWidth="340">
            <!-- Panel Header -->
            <HBox alignment="CENTER_LEFT" styleClass="panel-header">
                <padding>
                    <Insets top="12" right="12" bottom="12" left="16"/>
                </padding>
                <Label text="%panel.right.title" styleClass="panel-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="closeRightPanelBtn" text="×" onAction="#handleCloseRightPanel" styleClass="panel-close-btn">
                    <tooltip><Tooltip text="%tooltip.close_panel"/></tooltip>
                </Button>
            </HBox>
            
            <!-- Scrollable Content Area -->
            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="panel-scroll">
                <VBox fx:id="rightPanelContent" spacing="0" styleClass="panel-content">
                    <padding>
                        <Insets top="8" right="12" bottom="16" left="12"/>
                    </padding>
                    
                    <!-- Note Info Section (collapsible) -->
                    <VBox fx:id="noteInfoSection" styleClass="panel-section">
                        <HBox fx:id="noteInfoHeader" alignment="CENTER_LEFT" styleClass="section-header">
                            <Label text="▼" fx:id="noteInfoCollapseIcon" styleClass="collapse-icon"/>
                            <Label text="%section.note_info" styleClass="section-title"/>
                        </HBox>
                        <VBox fx:id="noteInfoContent" spacing="12" styleClass="section-content">
                            <padding>
                                <Insets top="8" left="8"/>
                            </padding>
                            <VBox spacing="2">
                                <Label text="%info.created" styleClass="info-label"/>
                                <Label fx:id="infoCreatedLabel" text="-" styleClass="info-value"/>
                            </VBox>
                            <VBox spacing="2">
                                <Label text="%info.modified" styleClass="info-label"/>
                                <Label fx:id="infoModifiedLabel" text="-" styleClass="info-value"/>
                            </VBox>
                            <HBox spacing="24">
                                <VBox spacing="2">
                                    <Label text="%info.words" styleClass="info-label"/>
                                    <Label fx:id="infoWordsLabel" text="0" styleClass="info-value"/>
                                </VBox>
                                <VBox spacing="2">
                                    <Label text="%info.chars" styleClass="info-label"/>
                                    <Label fx:id="infoCharsLabel" text="0" styleClass="info-value"/>
                                </VBox>
                            </HBox>
                            <VBox spacing="2">
                                <Label text="%info.location" styleClass="info-label"/>
                                <Label fx:id="infoLatitudeLabel" text="Lat: -" styleClass="info-value-small"/>
                                <Label fx:id="infoLongitudeLabel" text="Lon: -" styleClass="info-value-small"/>
                            </VBox>
                            <VBox spacing="2">
                                <Label text="%info.metadata" styleClass="info-label"/>
                                <Label fx:id="infoAuthorLabel" text="Author: -" styleClass="info-value-small"/>
                                <Label fx:id="infoSourceUrlLabel" text="URL: -" styleClass="info-value-small" wrapText="true"/>
                            </VBox>
                        </VBox>
                    </VBox>
                    
                    <!-- Plugin Panels Container (dynamic) -->
                    <VBox fx:id="pluginPanelsContainer" spacing="0">
                        <!-- Plugin panels are added dynamically here -->
                    </VBox>
                </VBox>
            </ScrollPane>
        </VBox>
    </right>
    
    <!-- Bottom Status Bar -->
    <bottom>
        <HBox fx:id="statusBar" alignment="CENTER_LEFT" spacing="20" styleClass="status-bar">
            <padding>
                <Insets top="8" right="20" bottom="8" left="20"/>
            </padding>
            <Label fx:id="statusLabel" text="Ready" styleClass="status-text"/>
            <Region HBox.hgrow="ALWAYS"/>
            <!-- Plugin status bar items container -->
            <HBox fx:id="pluginStatusBarContainer" spacing="12" alignment="CENTER_LEFT"/>
            <Label fx:id="noteCountLabel" text="0 notes" styleClass="status-text"/>
            <Separator orientation="VERTICAL" styleClass="status-separator"/>
            <Label fx:id="syncStatusLabel" text="Local" styleClass="status-text"/>
        </HBox>
    </bottom>
</BorderPane>
