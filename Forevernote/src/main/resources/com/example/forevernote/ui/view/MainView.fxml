<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.web.WebView?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.example.forevernote.ui.controller.MainController"
            styleClass="root-container">
    
    <!-- Top Menu Bar -->
    <top>
        <VBox styleClass="top-container">
            <MenuBar fx:id="menuBar" styleClass="menu-bar">
                <Menu text="File">
                    <MenuItem text="New Note" onAction="#handleNewNote" accelerator="Shortcut+N"/>
                    <MenuItem text="New Folder" onAction="#handleNewFolder" accelerator="Shortcut+Shift+N"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Save" onAction="#handleSave" accelerator="Shortcut+S"/>
                    <MenuItem text="Save All" onAction="#handleSaveAll" accelerator="Shortcut+Shift+S"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Import..." onAction="#handleImport" accelerator="Shortcut+I"/>
                    <MenuItem text="Export..." onAction="#handleExport" accelerator="Shortcut+E"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Exit" onAction="#handleExit" accelerator="Shortcut+Q"/>
                </Menu>
                
                <Menu text="Edit">
                    <MenuItem text="Undo" onAction="#handleUndo" accelerator="Shortcut+Z"/>
                    <MenuItem text="Redo" onAction="#handleRedo" accelerator="Shortcut+Y"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Cut" onAction="#handleCut" accelerator="Shortcut+X"/>
                    <MenuItem text="Copy" onAction="#handleCopy" accelerator="Shortcut+C"/>
                    <MenuItem text="Paste" onAction="#handlePaste" accelerator="Shortcut+V"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Find..." onAction="#handleFind" accelerator="Shortcut+F"/>
                    <MenuItem text="Replace..." onAction="#handleReplace" accelerator="Shortcut+H"/>
                </Menu>
                
                <Menu text="View">
                    <MenuItem text="Toggle Sidebar" onAction="#handleToggleSidebar" accelerator="F9"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Zoom In" onAction="#handleZoomIn" accelerator="Shortcut+Plus"/>
                    <MenuItem text="Zoom Out" onAction="#handleZoomOut" accelerator="Shortcut+Minus"/>
                    <MenuItem text="Reset Zoom" onAction="#handleResetZoom" accelerator="Shortcut+0"/>
                    <SeparatorMenuItem/>
                    <Menu text="Theme">
                        <RadioMenuItem fx:id="lightThemeMenuItem" text="Light" selected="true" onAction="#handleLightTheme"/>
                        <RadioMenuItem fx:id="darkThemeMenuItem" text="Dark" onAction="#handleDarkTheme"/>
                        <RadioMenuItem fx:id="systemThemeMenuItem" text="System" onAction="#handleSystemTheme"/>
                    </Menu>
                </Menu>
                
                <Menu text="Tools">
                    <MenuItem text="Command Palette" accelerator="Shortcut+P"/>
                    <MenuItem text="Quick Switcher" accelerator="Shortcut+O"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Global Search" onAction="#handleSearch" accelerator="Shortcut+Shift+F"/>
                    <MenuItem text="Tags Manager" onAction="#handleTagsManager"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Preferences" onAction="#handlePreferences"/>
                </Menu>
                
                <Menu text="Help">
                    <MenuItem text="Documentation" onAction="#handleDocumentation"/>
                    <MenuItem text="Keyboard Shortcuts" onAction="#handleKeyboardShortcuts" accelerator="F1"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="About Forevernote" onAction="#handleAbout"/>
                </Menu>
            </MenuBar>
            
            <!-- Toolbar -->
            <HBox styleClass="toolbar" spacing="8" alignment="CENTER_LEFT">
                <padding>
                    <Insets top="8" right="16" bottom="8" left="16"/>
                </padding>
                
                <Button fx:id="newNoteBtn" text="&#x1F4D3;" onAction="#handleNewNote" styleClass="toolbar-btn toolbar-btn-primary">
                    <tooltip><Tooltip text="New Note (Ctrl+N)"/></tooltip>
                </Button>
                <Button fx:id="newFolderBtn" text="&#x1F4C1;" onAction="#handleNewFolder" styleClass="toolbar-btn">
                    <tooltip><Tooltip text="New Folder"/></tooltip>
                </Button>
                <Separator orientation="VERTICAL" styleClass="toolbar-separator"/>
                <Button fx:id="saveBtn" text="Save" onAction="#handleSave" styleClass="toolbar-btn">
                    <tooltip><Tooltip text="Save (Ctrl+S)"/></tooltip>
                </Button>
                <Button fx:id="deleteBtn" text="Del" onAction="#handleDelete" styleClass="toolbar-btn toolbar-btn-danger">
                    <tooltip><Tooltip text="Delete"/></tooltip>
                </Button>
                <Separator orientation="VERTICAL" styleClass="toolbar-separator"/>
                
                <!-- Search Box -->
                <TextField fx:id="searchField" promptText="Search notes..." prefWidth="240" styleClass="search-field"/>
                
                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- Hidden toggle buttons for compatibility -->
                <ToggleButton fx:id="listViewButton" visible="false" managed="false" selected="true"/>
                <ToggleButton fx:id="gridViewButton" visible="false" managed="false"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- Main Content Area -->
    <center>
        <SplitPane fx:id="mainSplitPane" dividerPositions="0.22" styleClass="main-split">
            <!-- Left Sidebar -->
            <VBox fx:id="sidebarPane" styleClass="sidebar" minWidth="200">
                <!-- Navigation Tabs -->
                <TabPane fx:id="navigationTabPane" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS" styleClass="sidebar-tabs">
                    <Tab text="Folders" closable="false">
                        <TreeView fx:id="folderTreeView" showRoot="true" styleClass="sidebar-tree"/>
                    </Tab>
                    
                    <Tab text="Tags" closable="false">
                        <ListView fx:id="tagListView" styleClass="sidebar-list"/>
                    </Tab>
                    
                    <Tab text="Recent" closable="false">
                        <ListView fx:id="recentNotesListView" styleClass="sidebar-list"/>
                    </Tab>
                    
                    <Tab text="Favorites" closable="false">
                        <ListView fx:id="favoritesListView" styleClass="sidebar-list"/>
                    </Tab>
                </TabPane>
                
                <!-- Quick Actions -->
                <HBox spacing="6" alignment="CENTER" styleClass="sidebar-actions">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>
                    <Button fx:id="sidebarNewNoteBtn" text="&#x1F4D3;" onAction="#handleNewNote" styleClass="sidebar-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                        <tooltip><Tooltip text="New Note"/></tooltip>
                    </Button>
                    <Button fx:id="sidebarNewFolderBtn" text="&#x1F4C1;" onAction="#handleNewFolder" styleClass="sidebar-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                        <tooltip><Tooltip text="New Folder"/></tooltip>
                    </Button>
                    <Button fx:id="sidebarNewTagBtn" text="#" onAction="#handleNewTag" styleClass="sidebar-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                        <tooltip><Tooltip text="New Tag"/></tooltip>
                    </Button>
                </HBox>
            </VBox>
            
            <!-- Right Content Area -->
            <SplitPane fx:id="contentSplitPane" dividerPositions="0.30" styleClass="content-split">
                <!-- Notes List Panel -->
                <VBox styleClass="notes-panel" minWidth="200" maxWidth="360">
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="notes-header">
                        <padding>
                            <Insets top="12" right="12" bottom="12" left="12"/>
                        </padding>
                        <Label text="Notes" styleClass="panel-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="sortComboBox" prefWidth="120" styleClass="sort-combo"/>
                        <Button fx:id="refreshBtn" text="Refresh" onAction="#handleRefresh" styleClass="icon-btn">
                            <tooltip><Tooltip text="Refresh list"/></tooltip>
                        </Button>
                    </HBox>
                    
                    <ListView fx:id="notesListView" VBox.vgrow="ALWAYS" styleClass="notes-list"/>
                </VBox>
                
                <!-- Editor + Preview Panel -->
                <VBox styleClass="editor-container" HBox.hgrow="ALWAYS">
                    <!-- Editor Header -->
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="editor-header">
                        <padding>
                            <Insets top="10" right="16" bottom="10" left="16"/>
                        </padding>
                        <TextField fx:id="noteTitleField" promptText="Note title..." HBox.hgrow="ALWAYS" styleClass="title-field"/>
                        <Separator orientation="VERTICAL" styleClass="header-separator"/>
                        <!-- View Mode Toggle -->
                        <ToggleButton fx:id="editorOnlyButton" text="Edit" onAction="#handleEditorOnlyMode" styleClass="view-btn">
                            <tooltip><Tooltip text="Editor only (Alt+1)"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="splitViewButton" text="Split" onAction="#handleSplitViewMode" styleClass="view-btn">
                            <tooltip><Tooltip text="Split view (Alt+2)"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="previewOnlyButton" text="Read" onAction="#handlePreviewOnlyMode" styleClass="view-btn">
                            <tooltip><Tooltip text="Preview only (Alt+3)"/></tooltip>
                        </ToggleButton>
                        <Separator orientation="VERTICAL" styleClass="header-separator"/>
                        <Button fx:id="favoriteButton" text="*" onAction="#handleToggleFavorite" styleClass="action-btn">
                            <tooltip><Tooltip text="Add to favorites"/></tooltip>
                        </Button>
                        <Button fx:id="infoButton" text="i" onAction="#handleShowNoteInfo" styleClass="action-btn">
                            <tooltip><Tooltip text="Note information"/></tooltip>
                        </Button>
                        <Button fx:id="deleteNoteBtn" text="x" onAction="#handleDeleteNote" styleClass="action-btn action-btn-danger">
                            <tooltip><Tooltip text="Delete note"/></tooltip>
                        </Button>
                    </HBox>
                    
                    <!-- Tags Bar -->
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="tags-bar">
                        <padding>
                            <Insets top="6" right="16" bottom="6" left="16"/>
                        </padding>
                        <FlowPane fx:id="tagsFlowPane" hgap="6" vgap="6" styleClass="tags-flow"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="modifiedDateLabel" text="" styleClass="meta-label"/>
                    </HBox>
                    
                    <!-- Editor/Preview Split -->
                    <SplitPane fx:id="editorPreviewSplitPane" orientation="HORIZONTAL" dividerPositions="0.5" VBox.vgrow="ALWAYS" styleClass="editor-split">
                        <!-- Editor Pane -->
                        <VBox fx:id="editorPane" styleClass="editor-pane">
                            <TextArea fx:id="noteContentArea" promptText="Start writing in Markdown..." wrapText="true" VBox.vgrow="ALWAYS" styleClass="editor-area"/>
                            
                            <!-- Editor Toolbar (Obsidian-style) - Scrollable for responsiveness -->
                            <HBox styleClass="format-toolbar-container">
                                <ScrollPane hbarPolicy="AS_NEEDED" vbarPolicy="NEVER" fitToHeight="true" styleClass="format-toolbar-scroll" HBox.hgrow="ALWAYS">
                                    <HBox alignment="CENTER_LEFT" spacing="4" styleClass="format-toolbar">
                                        <padding>
                                            <Insets top="6" right="8" bottom="6" left="8"/>
                                        </padding>
                                        <Button fx:id="heading1Btn" text="H1" onAction="#handleHeading1" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 1"/></tooltip>
                                        </Button>
                                        <Button fx:id="heading2Btn" text="H2" onAction="#handleHeading2" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 2"/></tooltip>
                                        </Button>
                                        <Button fx:id="heading3Btn" text="H3" onAction="#handleHeading3" styleClass="format-btn">
                                            <tooltip><Tooltip text="Heading 3"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="boldBtn" text="B" onAction="#handleBold" styleClass="format-btn format-bold">
                                            <tooltip><Tooltip text="Bold (Ctrl+B)"/></tooltip>
                                        </Button>
                                        <Button fx:id="italicBtn" text="I" onAction="#handleItalic" styleClass="format-btn format-italic">
                                            <tooltip><Tooltip text="Italic (Ctrl+I)"/></tooltip>
                                        </Button>
                                        <Button fx:id="strikeBtn" text="S" onAction="#handleUnderline" styleClass="format-btn format-strike">
                                            <tooltip><Tooltip text="Strikethrough"/></tooltip>
                                        </Button>
                                        <Button fx:id="underlineBtn" text="U" onAction="#handleRealUnderline" styleClass="format-btn format-underline">
                                            <tooltip><Tooltip text="Underline"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="highlightBtn" text="Hi" onAction="#handleHighlight" styleClass="format-btn">
                                            <tooltip><Tooltip text="Highlight"/></tooltip>
                                        </Button>
                                        <Button fx:id="linkBtn" text="Lk" onAction="#handleLink" styleClass="format-btn">
                                            <tooltip><Tooltip text="Insert link (Ctrl+K)"/></tooltip>
                                        </Button>
                                        <Button fx:id="imageBtn" text="Img" onAction="#handleImage" styleClass="format-btn">
                                            <tooltip><Tooltip text="Insert image"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="todoBtn" text="[ ]" onAction="#handleTodoList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Checkbox"/></tooltip>
                                        </Button>
                                        <Button fx:id="bulletBtn" text="-" onAction="#handleBulletList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Bullet list"/></tooltip>
                                        </Button>
                                        <Button fx:id="numberBtn" text="1." onAction="#handleNumberedList" styleClass="format-btn">
                                            <tooltip><Tooltip text="Numbered list"/></tooltip>
                                        </Button>
                                        <Separator orientation="VERTICAL" styleClass="format-separator"/>
                                        <Button fx:id="quoteBtn" text="&gt;" onAction="#handleQuote" styleClass="format-btn">
                                            <tooltip><Tooltip text="Blockquote"/></tooltip>
                                        </Button>
                                        <Button fx:id="codeBtn" text="&lt;/&gt;" onAction="#handleCode" styleClass="format-btn">
                                            <tooltip><Tooltip text="Code block"/></tooltip>
                                        </Button>
                                    </HBox>
                                </ScrollPane>
                                <Label fx:id="wordCountLabel" text="0 words" styleClass="word-count"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Preview Pane -->
                        <VBox fx:id="previewPane" styleClass="preview-pane">
                            <HBox styleClass="preview-header">
                                <padding>
                                    <Insets top="8" right="12" bottom="8" left="12"/>
                                </padding>
                                <Label text="Preview" styleClass="preview-label"/>
                            </HBox>
                            <WebView fx:id="previewWebView" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </SplitPane>
                </VBox>
            </SplitPane>
        </SplitPane>
    </center>
    
    <!-- Right Info Panel -->
    <right>
        <VBox fx:id="infoPanel" visible="false" managed="false" styleClass="info-panel" minWidth="240" prefWidth="280" maxWidth="320">
            <padding>
                <Insets top="16" right="16" bottom="16" left="16"/>
            </padding>
            
            <HBox alignment="CENTER_LEFT" styleClass="info-header">
                <Label text="Note Info" styleClass="info-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="closeInfoBtn" text="x" onAction="#handleCloseInfoPanel" styleClass="close-btn">
                    <tooltip><Tooltip text="Close panel"/></tooltip>
                </Button>
            </HBox>
            
            <Separator styleClass="info-separator"/>
            
            <VBox spacing="16" VBox.vgrow="ALWAYS" styleClass="info-content">
                <padding>
                    <Insets top="16"/>
                </padding>
                
                <VBox spacing="4" styleClass="info-section">
                    <Label text="CREATED" styleClass="info-label"/>
                    <Label fx:id="infoCreatedLabel" text="-" styleClass="info-value"/>
                </VBox>
                
                <VBox spacing="4" styleClass="info-section">
                    <Label text="MODIFIED" styleClass="info-label"/>
                    <Label fx:id="infoModifiedLabel" text="-" styleClass="info-value"/>
                </VBox>
                
                <Separator styleClass="info-separator"/>
                
                <VBox spacing="4" styleClass="info-section">
                    <Label text="STATISTICS" styleClass="info-label"/>
                    <HBox spacing="24">
                        <VBox spacing="2">
                            <Label text="Words" styleClass="info-sublabel"/>
                            <Label fx:id="infoWordsLabel" text="0" styleClass="info-value"/>
                        </VBox>
                        <VBox spacing="2">
                            <Label text="Characters" styleClass="info-sublabel"/>
                            <Label fx:id="infoCharsLabel" text="0" styleClass="info-value"/>
                        </VBox>
                    </HBox>
                </VBox>
                
                <Separator styleClass="info-separator"/>
                
                <VBox spacing="4" styleClass="info-section">
                    <Label text="LOCATION" styleClass="info-label"/>
                    <Label fx:id="infoLatitudeLabel" text="Lat: -" styleClass="info-value"/>
                    <Label fx:id="infoLongitudeLabel" text="Lon: -" styleClass="info-value"/>
                </VBox>
                
                <VBox spacing="4" styleClass="info-section">
                    <Label text="METADATA" styleClass="info-label"/>
                    <Label fx:id="infoAuthorLabel" text="Author: -" styleClass="info-value"/>
                    <Label fx:id="infoSourceUrlLabel" text="URL: -" styleClass="info-value" wrapText="true"/>
                </VBox>
            </VBox>
        </VBox>
    </right>
    
    <!-- Bottom Status Bar -->
    <bottom>
        <HBox fx:id="statusBar" alignment="CENTER_LEFT" spacing="20" styleClass="status-bar">
            <padding>
                <Insets top="8" right="20" bottom="8" left="20"/>
            </padding>
            <Label fx:id="statusLabel" text="Ready" styleClass="status-text"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="noteCountLabel" text="0 notes" styleClass="status-text"/>
            <Separator orientation="VERTICAL" styleClass="status-separator"/>
            <Label fx:id="syncStatusLabel" text="Local" styleClass="status-text"/>
        </HBox>
    </bottom>
</BorderPane>
