<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.web.WebView?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.example.forevernote.ui.controller.MainController">
    
    <!-- Top Menu Bar -->
    <top>
        <VBox>
            <MenuBar fx:id="menuBar">
                <Menu text="File">
                    <MenuItem text="New Note" onAction="#handleNewNote" accelerator="Shortcut+N"/>
                    <MenuItem text="New Folder" onAction="#handleNewFolder" accelerator="Shortcut+Shift+N"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Save" onAction="#handleSave" accelerator="Shortcut+S"/>
                    <MenuItem text="Save All" onAction="#handleSaveAll" accelerator="Shortcut+Shift+S"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Import" onAction="#handleImport"/>
                    <MenuItem text="Export" onAction="#handleExport" accelerator="Shortcut+E"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Exit" onAction="#handleExit" accelerator="Shortcut+Q"/>
                </Menu>
                
                <Menu text="Edit">
                    <MenuItem text="Undo" onAction="#handleUndo" accelerator="Shortcut+Z"/>
                    <MenuItem text="Redo" onAction="#handleRedo" accelerator="Shortcut+Y"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Cut" onAction="#handleCut" accelerator="Shortcut+X"/>
                    <MenuItem text="Copy" onAction="#handleCopy" accelerator="Shortcut+C"/>
                    <MenuItem text="Paste" onAction="#handlePaste" accelerator="Shortcut+V"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Find" onAction="#handleFind" accelerator="Shortcut+F"/>
                    <MenuItem text="Replace" onAction="#handleReplace" accelerator="Shortcut+H"/>
                </Menu>
                
                <Menu text="View">
                    <MenuItem text="Toggle Sidebar" onAction="#handleToggleSidebar" accelerator="F9"/>
                    <MenuItem text="Zoom In" onAction="#handleZoomIn" accelerator="Shortcut+Plus"/>
                    <MenuItem text="Zoom Out" onAction="#handleZoomOut" accelerator="Shortcut+Minus"/>
                    <MenuItem text="Reset Zoom" onAction="#handleResetZoom" accelerator="Shortcut+0"/>
                    <SeparatorMenuItem/>
                    <Menu text="Theme">
                        <RadioMenuItem fx:id="lightThemeMenuItem" text="Light" selected="true" onAction="#handleLightTheme"/>
                        <RadioMenuItem fx:id="darkThemeMenuItem" text="Dark" onAction="#handleDarkTheme"/>
                        <RadioMenuItem fx:id="systemThemeMenuItem" text="System" onAction="#handleSystemTheme"/>
                    </Menu>
                </Menu>
                
                <Menu text="Tools">
                    <MenuItem text="Search" onAction="#handleSearch" accelerator="Shortcut+Shift+F"/>
                    <MenuItem text="Tags Manager" onAction="#handleTagsManager"/>
                    <MenuItem text="Preferences" onAction="#handlePreferences"/>
                </Menu>
                
                <Menu text="Help">
                    <MenuItem text="Documentation" onAction="#handleDocumentation"/>
                    <MenuItem text="Keyboard Shortcuts" onAction="#handleKeyboardShortcuts" accelerator="F1"/>
                    <MenuItem text="About" onAction="#handleAbout"/>
                </Menu>
            </MenuBar>
            
            <!-- Toolbar -->
            <HBox styleClass="toolbar" spacing="10" alignment="CENTER_LEFT">
                <padding>
                    <Insets top="5" right="10" bottom="5" left="10"/>
                </padding>
                
                <Button text="New Note" onAction="#handleNewNote" styleClass="toolbar-button"/>
                <Button text="New Folder" onAction="#handleNewFolder" styleClass="toolbar-button"/>
                <Separator orientation="VERTICAL"/>
                <Button text="Save" onAction="#handleSave" styleClass="toolbar-button"/>
                <Button text="Delete" onAction="#handleDelete" styleClass="toolbar-button"/>
                <Separator orientation="VERTICAL"/>
                
                <!-- Search Box -->
                <TextField fx:id="searchField" promptText="Search notes..." prefWidth="200" styleClass="search-field"/>
                <Button text="ðŸ”" onAction="#handleSearch" styleClass="search-button"/>
                
                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- View Options -->
                <ToggleButton fx:id="listViewButton" text="ðŸ“‹" selected="true" styleClass="view-toggle"/>
                <ToggleButton fx:id="gridViewButton" text="âŠž" styleClass="view-toggle"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- Main Content Area -->
    <center>
        <SplitPane fx:id="mainSplitPane" dividerPositions="0.25">
            <!-- Left Sidebar -->
            <VBox styleClass="sidebar">
                <!-- Navigation Tabs -->
                <TabPane fx:id="navigationTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="navigation-tabs">
                    <Tab text="ðŸ“ Folders" closable="false">
                        <TreeView fx:id="folderTreeView" styleClass="folder-tree" showRoot="true"/>
                    </Tab>
                    
                    <Tab text="ðŸ·ï¸ Tags" closable="false">
                        <ListView fx:id="tagListView" styleClass="tag-list"/>
                    </Tab>
                    
                    <Tab text="ðŸ“… Recent" closable="false">
                        <ListView fx:id="recentNotesListView" styleClass="recent-list"/>
                    </Tab>
                    
                    <Tab text="â­ Favorites" closable="false">
                        <ListView fx:id="favoritesListView" styleClass="favorites-list"/>
                    </Tab>
                </TabPane>
                
                <!-- Quick Actions -->
                <HBox styleClass="quick-actions" spacing="5" alignment="CENTER">
                    <padding>
                        <Insets top="10" right="5" bottom="10" left="5"/>
                    </padding>
                    <Button text="âž• Note" onAction="#handleNewNote" styleClass="quick-action-button"/>
                    <Button text="ðŸ“ Folder" onAction="#handleNewFolder" styleClass="quick-action-button"/>
                    <Button text="ðŸ·ï¸ Tag" onAction="#handleNewTag" styleClass="quick-action-button"/>
                </HBox>
            </VBox>
            
            <!-- Right Content Area - Obsidian-style layout -->
            <SplitPane fx:id="contentSplitPane" dividerPositions="0.25">
                <!-- Notes List Panel -->
                <VBox styleClass="notes-list-container" minWidth="200" maxWidth="350">
                    <HBox styleClass="notes-header" alignment="CENTER_LEFT" spacing="8">
                        <padding>
                            <Insets top="8" right="8" bottom="8" left="8"/>
                        </padding>
                        <Label text="Notes" styleClass="section-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="sortComboBox" prefWidth="100" styleClass="sort-combo"/>
                        <Button text="â†»" onAction="#handleRefresh" styleClass="icon-button">
                            <tooltip><Tooltip text="Refresh"/></tooltip>
                        </Button>
                    </HBox>
                    
                    <ListView fx:id="notesListView" styleClass="notes-list" VBox.vgrow="ALWAYS"/>
                </VBox>
                
                <!-- Editor + Preview Panel (Obsidian-style) -->
                <VBox styleClass="editor-preview-container" HBox.hgrow="ALWAYS">
                    <!-- Unified Header Bar -->
                    <HBox styleClass="editor-header" alignment="CENTER_LEFT" spacing="8">
                        <padding>
                            <Insets top="6" right="12" bottom="6" left="12"/>
                        </padding>
                        <TextField fx:id="noteTitleField" promptText="Untitled" styleClass="note-title-field" HBox.hgrow="ALWAYS"/>
                        <Separator orientation="VERTICAL"/>
                        <!-- View Mode Toggle Buttons -->
                        <ToggleButton fx:id="editorOnlyButton" text="âœï¸" styleClass="view-mode-button" onAction="#handleEditorOnlyMode">
                            <tooltip><Tooltip text="Editor only"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="splitViewButton" text="â—§" styleClass="view-mode-button" onAction="#handleSplitViewMode">
                            <tooltip><Tooltip text="Split view"/></tooltip>
                        </ToggleButton>
                        <ToggleButton fx:id="previewOnlyButton" text="ðŸ‘" styleClass="view-mode-button" onAction="#handlePreviewOnlyMode">
                            <tooltip><Tooltip text="Preview only"/></tooltip>
                        </ToggleButton>
                        <Separator orientation="VERTICAL"/>
                        <Button text="â­" fx:id="favoriteButton" onAction="#handleToggleFavorite" styleClass="icon-button">
                            <tooltip><Tooltip text="Toggle favorite"/></tooltip>
                        </Button>
                        <Button text="â„¹" onAction="#handleShowNoteInfo" styleClass="icon-button">
                            <tooltip><Tooltip text="Note info"/></tooltip>
                        </Button>
                        <Button text="ðŸ—‘" onAction="#handleDeleteNote" styleClass="icon-button-danger">
                            <tooltip><Tooltip text="Delete note"/></tooltip>
                        </Button>
                    </HBox>
                    
                    <!-- Tags Bar -->
                    <HBox styleClass="tags-bar" alignment="CENTER_LEFT" spacing="6">
                        <padding>
                            <Insets top="4" right="12" bottom="4" left="12"/>
                        </padding>
                        <FlowPane fx:id="tagsFlowPane" hgap="6" vgap="4" styleClass="tags-flow"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="modifiedDateLabel" text="" styleClass="metadata-label-subtle"/>
                    </HBox>
                    
                    <!-- Editor/Preview Split (Obsidian-style horizontal) -->
                    <SplitPane fx:id="editorPreviewSplitPane" orientation="HORIZONTAL" dividerPositions="0.5" VBox.vgrow="ALWAYS" styleClass="editor-preview-split">
                        <!-- Editor Pane -->
                        <VBox fx:id="editorPane" styleClass="editor-pane">
                            <TextArea fx:id="noteContentArea" promptText="Start writing..." wrapText="true" styleClass="note-content-area" VBox.vgrow="ALWAYS"/>
                            
                            <!-- Minimal Editor Toolbar -->
                            <HBox styleClass="editor-toolbar-minimal" alignment="CENTER_LEFT" spacing="4">
                                <padding>
                                    <Insets top="4" right="8" bottom="4" left="8"/>
                                </padding>
                                <Button text="B" onAction="#handleBold" styleClass="format-btn">
                                    <tooltip><Tooltip text="Bold (Ctrl+B)"/></tooltip>
                                </Button>
                                <Button text="I" onAction="#handleItalic" styleClass="format-btn format-btn-italic">
                                    <tooltip><Tooltip text="Italic (Ctrl+I)"/></tooltip>
                                </Button>
                                <Button text="~" onAction="#handleUnderline" styleClass="format-btn">
                                    <tooltip><Tooltip text="Strikethrough"/></tooltip>
                                </Button>
                                <Separator orientation="VERTICAL" styleClass="toolbar-separator"/>
                                <Button text="ðŸ”—" onAction="#handleLink" styleClass="format-btn">
                                    <tooltip><Tooltip text="Insert link"/></tooltip>
                                </Button>
                                <Button text="ðŸ“·" onAction="#handleImage" styleClass="format-btn">
                                    <tooltip><Tooltip text="Insert image"/></tooltip>
                                </Button>
                                <Separator orientation="VERTICAL" styleClass="toolbar-separator"/>
                                <Button text="â˜" onAction="#handleTodoList" styleClass="format-btn">
                                    <tooltip><Tooltip text="Todo list"/></tooltip>
                                </Button>
                                <Button text="#" onAction="#handleNumberedList" styleClass="format-btn">
                                    <tooltip><Tooltip text="Numbered list"/></tooltip>
                                </Button>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="wordCountLabel" text="0 words" styleClass="word-count-label"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Preview Pane -->
                        <VBox fx:id="previewPane" styleClass="preview-pane">
                            <HBox styleClass="preview-header" alignment="CENTER_LEFT">
                                <padding>
                                    <Insets top="4" right="8" bottom="4" left="12"/>
                                </padding>
                                <Label text="Preview" styleClass="preview-title"/>
                            </HBox>
                            <WebView fx:id="previewWebView" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </SplitPane>
                </VBox>
            </SplitPane>
            
            <!-- Note Info Panel (hidden by default, toggled) -->
            <VBox fx:id="infoPanel" styleClass="info-panel" visible="false" managed="false" minWidth="250" maxWidth="300">
                <HBox styleClass="info-panel-header" alignment="CENTER_LEFT">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>
                    <Label text="Note Info" styleClass="info-panel-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="âœ•" onAction="#handleCloseInfoPanel" styleClass="close-button"/>
                </HBox>
                
                <VBox styleClass="info-content" spacing="12" VBox.vgrow="ALWAYS">
                    <padding>
                        <Insets top="10" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <VBox spacing="4">
                        <Label text="CREATED" styleClass="info-section-label"/>
                        <Label fx:id="infoCreatedLabel" text="-" styleClass="info-value"/>
                    </VBox>
                    
                    <VBox spacing="4">
                        <Label text="MODIFIED" styleClass="info-section-label"/>
                        <Label fx:id="infoModifiedLabel" text="-" styleClass="info-value"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="4">
                        <Label text="STATISTICS" styleClass="info-section-label"/>
                        <HBox spacing="20">
                            <VBox spacing="2">
                                <Label fx:id="infoWordsLabel" text="0" styleClass="info-stat-value"/>
                                <Label text="words" styleClass="info-stat-label"/>
                            </VBox>
                            <VBox spacing="2">
                                <Label fx:id="infoCharsLabel" text="0" styleClass="info-stat-value"/>
                                <Label text="characters" styleClass="info-stat-label"/>
                            </VBox>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="4">
                        <Label text="LOCATION" styleClass="info-section-label"/>
                        <Label fx:id="infoLatitudeLabel" text="Lat: -" styleClass="info-value-small"/>
                        <Label fx:id="infoLongitudeLabel" text="Lon: -" styleClass="info-value-small"/>
                    </VBox>
                    
                    <VBox spacing="4">
                        <Label text="SOURCE" styleClass="info-section-label"/>
                        <Label fx:id="infoAuthorLabel" text="Author: -" styleClass="info-value-small"/>
                        <Label fx:id="infoSourceUrlLabel" text="URL: -" styleClass="info-value-small" wrapText="true"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="4">
                        <Label text="ATTACHMENTS" styleClass="info-section-label"/>
                        <ListView fx:id="attachmentsListView" styleClass="attachments-list-compact" prefHeight="100"/>
                    </VBox>
                </VBox>
            </VBox>
        </SplitPane>
    </center>
    
    <!-- Status Bar -->
    <bottom>
        <HBox styleClass="status-bar" alignment="CENTER_LEFT" spacing="15">
            <padding>
                <Insets top="5" right="10" bottom="5" left="10"/>
            </padding>
            <Label fx:id="statusLabel" text="Ready" styleClass="status-text"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="noteCountLabel" text="0 notes" styleClass="status-text"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="syncStatusLabel" text="Offline" styleClass="status-text"/>
        </HBox>
    </bottom>
    
</BorderPane>